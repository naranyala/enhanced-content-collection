---
import Layout from '../layouts/Layout.astro';

import { getCollection } from 'astro:content';
import { enhanceContentCollection } from '../lib/utils/markdown'

import imageError from '../assets/example-error.png'

const demoCollection = await getCollection("en-demo")
const finalCollection = enhanceContentCollection(demoCollection)
// console.log(demoCollection)
// console.log(finalCollection)
const { Content } = await finalCollection[1].render();

--- 

<Layout title="Enhance Content Collection">
	<header class="m-4 p-4 border-2 border-gray-300 rounded-lg leading-10 text-justify">
		<h1 class="text-3xl font-bold text-left">Demo Enhanced Content Collection</h1><hr/>
		<p>Depend on "markdown-it" and "sanitize-html"</p><hr/>
		<h2 class="font-bold">Example Error (strict content heading)</h2>
		<img src={imageError.src} alt="error" class="w-full"/>
		<hr/>
		<h2 class="font-bold">Context</h2>
		<p>The main difference is the new "headings" object for each Markdown content, which currently needs to be set up manually. It would be handy if it were built-in as a feature in Astro's content collection.</p><hr/>
		<h2 class="font-bold">Explanation</h2>
		<p>My primary goal is to make it easier to create a table-of-contents and enable fuzzy searching deep into markdown headings (e.g., using Fuse.js).</p>
		<h2 class="font-bold">DEMO CONTENT</h2>
		<span>In markdown content, try to change default `h1` into `h2`, from `#` into `##`</span>
		<ul>
			{finalCollection.map((item, idx) => (
					<li class="hover:underline text-blue-600"><a href={item.slug}>{item.data.title}</a></li>
			))}
		</ul>
		<hr/>
		<h2 class="font-bold">DEMO FUZZY SEARCH</h2>
		<a href="/fuzzy-search" class="hover:underline text-blue-600">Search Heading Content</a>
	</header>
	<main>
		<span class="text-2xl ml-4">from this:</span>
		<small><pre class="bg-gray-300 rounded-lg m-4 p-4 overflow-x-auto">{JSON.stringify(demoCollection, null, 2)}</pre></small>

		<span class="text-2xl ml-4">to this:</span>
		<small><pre class="bg-gray-300 rounded-lg m-4 p-4 overflow-x-auto">{JSON.stringify(finalCollection, null, 2)}</pre></small>
	</main>

</Layout>

<style>
	
</style>
